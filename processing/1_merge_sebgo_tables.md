Merge SegBo Phoneme and Metadata tables
================
Steven Moran
18 May, 2020

``` r
# Load SegBo CSV dumps from Google sheets
segbo.phonemes <- read.csv('../data/SegBo database - Phonemes.csv', na.strings = "", stringsAsFactors = FALSE)
segbo.metadata <- read.csv('../data/SegBo database - Metadata.csv', na.strings = "", stringsAsFactors = FALSE)
```

``` r
df <- left_join(segbo.phonemes, segbo.metadata, by=c("InventoryID"="InventoryID"))
glimpse(df)
```

    ## Rows: 1,666
    ## Columns: 17
    ## $ InventoryID                 <int> 1, 1, 2, 2, 2, 3, 3, 4, 4, 5, 6, 7, 8, 8,…
    ## $ BorrowingLanguageGlottocode <chr> "abau1245", "abau1245", "abui1241", "abui…
    ## $ BorrowedSound               <chr> "d̠ʒ", "t", "ɡ", "ɟ", "ts", "d̠ʒ", "n̠d̠ʒ…
    ## $ SourceLanguageGlottocode    <chr> "tokp1240", "tokp1240", "stan1306, indo13…
    ## $ OnlyInLoanwords             <chr> "yes", "no", "yes", "yes", "yes", "yes", …
    ## $ Result                      <chr> "new phoneme", "phonologization of alloph…
    ## $ NewDistinction              <chr> "affricate", "no", "no", "affricate", "af…
    ## $ PhonemeComments             <chr> NA, "allophone of /r/ in native phonology…
    ## $ Verified                    <chr> NA, NA, "Eitan Grossman", "Eitan Grossman…
    ## $ Glottocode                  <chr> "abau1245", "abau1245", "abui1241", "abui…
    ## $ LanguageName                <chr> "Abau", "Abau", "Abui", "Abui", "Abui", "…
    ## $ BibTexKey                   <chr> "bailey1975abau", "bailey1975abau", "krat…
    ## $ Filename                    <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ Contributor                 <chr> "Einav Levanon", "Einav Levanon", "Elad E…
    ## $ MetadataComments            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ PhoibleID                   <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ ClosestNeighbor             <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…

``` r
# Test that all of the Glottocodes match
expect_equal(nrow(df[which(df$Glottocode!=df$BorrowingLanguageGlottocode),] %>% select(InventoryID, BorrowingLanguageGlottocode, Glottocode, LanguageName, LanguageName)), 0)
```

``` r
# Test that all of the language names match
expect_equal(nrow(df[which(df$LanguageName!=df$BorrowingLanguageName),] %>% select(InventoryID, LanguageName, LanguageName)), 0)
```

``` r
# Test for any NA Glottocodes? in the BorrowingLanguageGlottocode field
expect_false(any(is.na(df$BorrowingLanguageGlottocode)))
```

``` r
# Write full table to disk
write.csv(df, file='../data/segbo_merged.csv', row.names = F)
```
